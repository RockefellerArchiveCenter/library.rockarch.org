---
layout: null
---
{
  {% for item_hash in site.data.resource %}
    {%- assign object = item_hash[1] -%}
    {%- assign id = item_hash[0] -%}
    {%- assign collection_id = object.uri | split:'/' | last -%}

    {%- assign agents = "" | split: ',' -%}
    {%- for agent in object.linked_agents -%}
      {%- capture agent_id -%}{{ agent.ref | split: '/' | last }}{%- endcapture -%}
      {%- if agent.ref contains "corporate_entities" -%}
        {%- assign agent_data = site.data.agent_corporate_entity[agent_id] -%}
      {%- elsif agent.ref contains "people" -%}
        {%- assign agent_data = site.data.agent_person[agent_id] -%}
      {%- elsif agent.ref contains "family" -%}
        {%- assign agent_data = site.data.agent_family[agent_id] -%}
      {%- endif -%}
      {%- assign agents = agents | push: agent_data.title -%}
    {%- endfor -%}

    {%- assign subjects = "" | split: ',' -%}
    {%- for subject in object.subjects -%}
      {%- capture subject_id -%}{{ subject.ref | split: '/' | last }}{%- endcapture -%}
      {%- assign obj = site.data.subject[subject_id] -%}
      {%- assign subjects = subjects | push: obj.title -%}
    {%- endfor -%}

    {%- assign notes = "" | split: ',' -%}
    {%- for note in object.notes -%}
      {%- include note_content.html -%}
    {%- endfor -%}

    {%- include call_numbers.html -%}

  "resource/{{id}}": {
      "title": "{{ object.title | escape | strip_newlines | remove: '\' }}",
      "url": "{{site.url}}/resource/{{id}}",
      "agents": "{{ agents | join: ', ' }}",
      "subjects": "{{ subjects | join: ', ' }}",
      "notes": "{{ notes | join: ', '}}",
      "call_numbers": "{{ call_numbers | uniq | join: ', ' }}"}{%- unless forloop.last -%},
  {% endunless %}
{% endfor %} }
