---
layout: null
---
{
  {% for item_hash in site.data.resource %}
    {%- assign object = item_hash[1] -%}
    {%- assign id = item_hash[0] -%}
    {%- assign collection_id = object.uri | split:'/' | last -%}

    {%- assign subjects = "" | split: ',' -%}
    {%- for subject in object.subjects -%}
      {%- capture subject_id -%}{{ subject.ref | split: '/' | last }}{%- endcapture -%}
      {%- assign obj = site.data.subject[subject_id] -%}
      {%- assign subjects = subjects | push: obj.title -%}
    {%- endfor -%}

    {%- assign subject_agents = "" | split: ',' -%}
    {%- for agent in object.linked_agents -%}
      {% if agent.role == "subject" %}
        {%- capture agent_title -%}{%- include linked_agent_title.html agent=agent -%}{%- endcapture -%}
        {%- assign subject_agents = subject_agents | push: agent_title -%}
      {% endif %}
    {%- endfor -%}

    {%- assign subjects = subjects | concat: subject_agents -%}

    {%- assign notes = "" | split: ',' -%}
    {%- for note in object.notes -%}
      {%- capture content -%}{%- include note_content.html -%}{%- endcapture -%}
      {%- assign notes = notes | push: content -%}
    {%- endfor -%}

  "/items/{{id}}/": {
      "title": "{{- object.title | escape | strip_newlines | remove: '\' -}}",
      "ref": "/items/{{id}}/",
      "url": "{{site.url}}/items/{{id}}/",
      "author": "{%- include author_list.html -%}",
      "subject": "{{- subjects | join: ', ' | strip_newlines | escape -}}",
      "notes": "{{- notes | join: ', ' | strip_newlines | strip_html | strip | remove: '\' | escape -}}",
      "dates": "{%- include date_list.html -%}",
      "call_numbers": "{%- include call_numbers.html -%}"}{%- unless forloop.last -%},
  {% endunless %}
{%- endfor -%} }
